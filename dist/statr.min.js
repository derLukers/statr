define("State",["StateManager"],function(t){"use strict";var e,n;return n=function(){var t;return t={},t.promise=new Promise(function(e,n){return t.resolve=e,t.reject=n}),t},e=function(){function e(){this.use(this.mixins.length?this.mixins:[this.mixins]),t.registerState(this)}return e.prototype.isActive=!1,e.prototype.mixins=[],e.prototype.activationHooks=[],e.prototype.doResolve=function(t,e){var r,i,o,u,s,a;if(null==e&&(e={}),s=n(),!this.resolve)return s.resolve(e),s.promise;a=[],i=this.resolve;for(r in i)o=i[r],u=o(t,e)||{},u.name=r,a.push(u);return Promise.all(a).then(function(t){return function(){var n,r;for(n in a)r=a[n],e[r.name]=arguments[n];return t.previousResolveResult=e,s.resolve(e)}}(this)),s.promise},e.prototype.activate=function(t,e,r){var i,o,u,s,a;return null==e&&(e=null),null==r&&(r=n()),o=null===e,u=n(),i=n(),this.currentChild!==e&&(null!=(a=this.currentChild)&&a.deactivate(),this.currentChild=e),o&&u.promise.then(r.resolve,r.reject),u.promise.then(function(t){return function(e){return t.previousResolveResult=e}}(this)),i.promise.then(function(n){return function(){return n.currentChild=e,n.isActive=!0,n.currentParams=t}}(this)),this.isActive&&this.paramsUnchanged(t)?(u.resolve(this.previousResolveResult),r.promise.then(i.resolve,i.reject)):this.parent?(s=this.parent.activate(t,this,r),s[0].then(function(e){return function(n){return e.doResolve(t,n).then(u.resolve,u.reject)}}(this)),s[1].then(function(e){return function(n){return e.executeActivationHooks(t,n).then(i.resolve,i.reject)}}(this))):(this.doResolve(t).then(u.resolve),r.promise.then(function(e){return function(n){return e.executeActivationHooks(t,n).then(i.resolve,i.reject)}}(this))),o?i.promise:[u.promise,i.promise]},e.prototype.paramsUnchanged=function(t,e){var n,r;return null==e&&(e=this.currentParams||{}),t?[function(){var i,o,u;for(u=[],r=i=0,o=e.length;o>i;r=++i)n=e[r],u.push(t[n]===r);return u}()].every(function(t){return t===!0}):!0},e.prototype.executeActivationHooks=function(t,e){var n,r;return r=[function(){var r,i,o,u;for(o=this.activationHooks,u=[],r=0,i=o.length;i>r;r++)n=o[r],u.push(n(t,e));return u}.call(this)],Promise.all(r)},e.prototype.deactivate=function(){var t;return this.isActive=!1,null!=(t=this.currentChild)&&t.deactivate(),"function"==typeof this.onDeactivate&&this.onDeactivate(),this.currentChild=null},e.prototype.onActivate=function(t){return this.activationHooks.push(t)},e.prototype.generateName=function(){var t;return""+[(null!=(t=this.parent)?t.statename:void 0)?this.parent.generateName()+".":void 0]+this.statename},e.prototype.getParentChain=function(){var t,e;return t=(null!=(e=this.parent)?e.getParentChain():void 0)||[],t.push(this),t},e.prototype.use=function(t){var e,n,r,i,o,u;for(e=0,r=t.length;r>e;e++){i=t[e],o=i.prototype;for(n in o)u=o[n],"constructor"!==n&&(this[n]=u);null!=i&&"function"==typeof i.call&&i.call(this)}return this},e}()}),define("StateManager",[],function(){var t;return new(t=function(){function t(){this.clear()}var e,n;return n={},e=null,t.prototype.go=function(t,r){var i;if(null==r&&(r={}),!n[t])throw new Error('No State with name "'+t+'" found.');return i=n[t],e=i,i.activate(r)},t.prototype.registerState=function(t){var e;if(e=t.generateName(),n[t.generateName()])throw new Error('State with name "'+e+'" already exists.');return n[t.generateName()]=t},t.prototype.getState=function(t){return n[t]},t.prototype.clear=function(){return null!=e&&e.getParentChain()[0].deactivate(),n={}},t}())});