!function(e,t){var n,r;if("function"==typeof define&&define.amd)define("State",["StateManager"],function(n){return e.State=t(n)});else{if("undefined"==typeof r)return e.State=t(n);if(n=require("StateManager"),r.State=t(n),"undefined"!=typeof module&&module.exports)return r=module.exports=t(n)}}(this,function(e){"use strict";var t,n,r;return r=function(e,t){var n,r,i;r=e;for(n in t)i=t[n],r=r.replace(":"+n,i);return r},n=function(){var e;return e={},e.promise=new Promise(function(t,n){return e.resolve=t,e.reject=n}),e},t=function(){function t(){e.registerState(this)}return t.prototype.isActive=!1,t.prototype.insertParameters=r,t.prototype.doResolve=function(e,t){var n;return null==t&&(t={}),n=new Promise(function(r){return function(i){var o,u,a,s,c;if(r.resolve){s=[],c=r.resolve;for(u in c)a=c[u],o=a(e,t),o.name=u,s.push(o);return Promise.all(s).then(function(){var e,n;for(e in s)n=s[e],t[n.name]=arguments[e];return i(t)})}return i(t),n}}(this))},t.prototype.activate=function(e,t,r){var i,o,u;return null==t&&(t=null),null==r&&(r=n()),i=null===t,o=n(),i&&o.promise.then(function(e){return r.resolve(e)}),this.currentChild!==t&&(null!=(u=this.currentChild)&&u.deactivate(),this.currentChild=t),this.isActive&&this.generateRoute(this.currentParameters)===this.generateRoute(e)?o.resolve(this.previousResolveResult):this.parent?this.parent.activate(e,this,r).then(function(t){return function(n){return t.doResolve(e,n).then(function(e){return t.previousResolveResult=e,o.resolve(e)})}}(this)):this.doResolve(e).then(function(e){return function(t){return e.previousResolveResult=t,o.resolve(t)}}(this)),r.promise.then(function(n){return function(r){return n.currentChild=t,n.isActive=!0,"function"==typeof n.onActivate?n.onActivate(e,r):void 0}}(this)),this.currentParameters=e,o.promise},t.prototype.deactivate=function(){var e;return this.isActive=!1,"function"==typeof this.onDeactivate&&this.onDeactivate(),null!=(e=this.currentChild)&&e.deactivate(),this.currentChild=null},t.prototype.generateRoute=function(e){var t;return""+[(null!=(t=this.parent)?t.generateRoute(e).length:void 0)?this.parent.generateRoute(e)+"/":void 0]+(""+[this.route?r(this.route,e):void 0])},t.prototype.generateRouteString=function(){var e;return""+[(null!=(e=this.parent)?e.generateRouteString().length:void 0)?""+this.parent.generateRouteString()+(this.route?"/":void 0):void 0]+[this.route]},t.prototype.generateName=function(){var e;return""+[(null!=(e=this.parent)?e.statename:void 0)?this.parent.generateName()+".":void 0]+this.statename},t.prototype.getParentChain=function(){var e,t;return e=(null!=(t=this.parent)?t.getParentChain():void 0)||[],e.push(this),e},t}()}),function(e,t){var n,r;if("function"==typeof define&&define.amd)define("StateManager",["backbone"],function(n){return e.StateManager=new(t(n))});else{if("undefined"==typeof r)return e.StateManager=new(t(n));if(n=require("Backbone"),r.StateManager=new(t(n)),"undefined"!=typeof module&&module.exports)return r=module.exports=new StateManager}}(this,function(e){var t;return t=function(){function t(){this.clear()}var n,r;return r={},n=null,t.prototype.router=new e.Router,t.prototype.go=function(e,t,i){var o;if(null==t&&(t={}),null==i&&(i={navigate:!0}),!r[e])throw new Error('No State with name "'+e+"' found.");return o=r[e],o.activate(t),n=o,i.navigate&&!o.abstract&&o.route?this.router.navigate(o.generateRoute(t)):void 0},t.prototype.registerState=function(e){var t;if(t=e.generateName(),r[e.generateName()])throw new Error('State with name "'+t+'" already exists.');return r[e.generateName()]=e,!e.route&&""!==e.route||e.abstract?void 0:this.router.route(e.generateRouteString(),e.generateName(),function(){var n,r,i,o,u,a;for(i=arguments,r={},a=e.generateRouteString().match(/:([a-zA-Z0-9\-_]+)/g),n=o=0,u=a.length;u>o;n=++o)t=a[n],r[t.substring(1)]=i[n];return e.activate(r)})},t.prototype.getState=function(e){return r[e]},t.prototype.clear=function(){return null!=n&&n.getParentChain()[0].deactivate(),r={}},t}()});