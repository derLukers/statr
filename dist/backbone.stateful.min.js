define("State",["StateManager"],function(t){"use strict";var e,r,n;return n=function(t,e){var r,n,i;n=t;for(r in e)i=e[r],n=n.replace(":"+r,i);return n},r=function(){var t;return t={},t.promise=new Promise(function(e,r){return t.resolve=e,t.reject=r}),t},e=function(){function e(){t.registerState(this)}return e.prototype.isActive=!1,e.prototype.insertParameters=n,e.prototype.doResolve=function(t,e){var n,i,o,a,u,s;if(null==e&&(e={}),a=r(),!this.resolve)return a.resolve(e),a.promise;u=[],s=this.resolve;for(i in s)o=s[i],n=o(t,e),n.name=i,u.push(n);return Promise.all(u).then(function(){var t,r;for(t in u)r=u[t],e[r.name]=arguments[t];return this.previousResolveResult=e,a.resolve(e)}),a.promise},e.prototype.activate=function(t,e,n){var i,o,a,u,s;return null==e&&(e=null),null==n&&(n=r()),o=null===e,a=r(),i=r(),this.currentChild!==e&&(null!=(s=this.currentChild)&&s.deactivate(),this.currentChild=e),o&&a.promise.then(n.resolve,n.reject),a.promise.then(function(t){return function(){return t.previousResolveResult=resolveResult}}(this)),n.promise.then(function(r){return function(){return r.currentChild=e,r.isActive=!0,r.currentParams=t}}(this)),this.isActive&&this.paramsUnchanged(t)?(a.resolve(this.previousResolveResult),n.promise.then(i.resolve,i.reject)):this.parent?(u=this.parent.activate(t,this,n),u[0].then(function(e){return function(r){return e.doResolve(t,r).then(a.resolve,a.reject)}}(this)),u[1].then(function(e){return function(r){return"function"==typeof e.onActivate&&e.onActivate(t,r),i.resolve(r)}}(this))):(this.doResolve(t).then(a.resolve),n.promise.then(function(e){return function(r){return"function"==typeof e.onActivate&&e.onActivate(t,r),i.resolve(r)}}(this))),o?i.promise:[a.promise,i.promise]},e.prototype.paramsUnchanged=function(t){var e,r;return[function(){var n,i,o,a;for(o=this.currentParams,a=[],r=n=0,i=o.length;i>n;r=++n)e=o[r],a.push(t[e]===r);return a}.call(this)].every(function(t){return t===!0})},e.prototype.deactivate=function(){var t;return this.isActive=!1,null!=(t=this.currentChild)&&t.deactivate(),"function"==typeof this.onDeactivate&&this.onDeactivate(),this.currentChild=null},e.prototype.generateRoute=function(t){var e;return""+[(null!=(e=this.parent)?e.generateRoute(t).length:void 0)?this.parent.generateRoute(t)+"/":void 0]+(""+[this.route?n(this.route,t):void 0])},e.prototype.generateRouteString=function(){var t;return""+[(null!=(t=this.parent)?t.generateRouteString().length:void 0)?""+this.parent.generateRouteString()+(this.route?"/":void 0):void 0]+[this.route]},e.prototype.generateName=function(){var t;return""+[(null!=(t=this.parent)?t.statename:void 0)?this.parent.generateName()+".":void 0]+this.statename},e.prototype.getParentChain=function(){var t,e;return t=(null!=(e=this.parent)?e.getParentChain():void 0)||[],t.push(this),t},e}()}),define("StateManager",["backbone"],function(t){var e;return new(e=function(){function e(){this.clear()}var r,n;return n={},r=null,e.prototype.router=new t.Router,e.prototype.go=function(t,e,i){var o,a;if(null==e&&(e={}),null==i&&(i={navigate:!0}),!n[t])throw new Error('No State with name "'+t+"' found.");return a=n[t],o=a.activate(e),r=a,i.navigate&&!a.abstract&&a.route&&this.router.navigate(a.generateRoute(e)),o},e.prototype.registerState=function(t){var e;if(e=t.generateName(),n[t.generateName()])throw new Error('State with name "'+e+'" already exists.');return n[t.generateName()]=t,!t.route&&""!==t.route||t.abstract?void 0:this.router.route(t.generateRouteString(),t.generateName(),function(){var r,n,i,o,a,u;if(o=arguments,i={},n=t.generateRouteString().match(/:([a-zA-Z0-9\-_]+)/g))for(r=a=0,u=n.length;u>a;r=++a)e=n[r],i[e.substring(1)]=o[r];return t.activate(i)})},e.prototype.getState=function(t){return n[t]},e.prototype.clear=function(){return null!=r&&r.getParentChain()[0].deactivate(),n={}},e}())});