!function(e,t){var r,n,i;if("function"==typeof define&&define.amd)define("State",["StateManager","underscore"],function(r,n){return e.State=t(r,n)});else{if("undefined"==typeof n)return e.State=t(r,i);if(r=require("StateManager"),i=require("underscore"),n.State=t(r,i),"undefined"!=typeof module&&module.exports)return n=module.exports=t(r,i)}}(this,function(e,t){"use strict";var r;return t.templateSettings={interpolate:/:([a-zA-Z0-9_]+)/g},r=function(){function r(){console.log(e.toString()),e.registerState(this)}return r.prototype.isActive=!1,r.prototype.doResolve=function(e,t){var r,n,i,o,a,u;if(null==t&&(t={}),o=$.Deferred(),!this.resolve)return o.resolve(t),o;a=[],u=this.resolve;for(n in u)i=u[n],r=i.apply(this,e,t),r.name=n,a.push(r);return $.when.apply($,a).then(function(){var e,r;for(e in a)r=a[e],t[r.name]=arguments[e];return o.resolve(t)}),o},r.prototype.activate=function(e,t,r){var n,i,o;return null==t&&(t=null),null==r&&(r=$.Deferred()),n=null===t,i=$.Deferred(),n&&i.then(function(e){return r.resolve(e)}),this.currentChild!==t&&(null!=(o=this.currentChild)&&o.deactivate(),this.currentChild=t),this.isActive&&this.generateRoute(this.currentParameters)===this.generateRoute(e)?i.resolve(this.previousResolveResult):(this.parent?this.parent.activate(e,this,r).then(function(t){return function(r){return t.doResolve(e,r).then(function(e){return t.previousResolveResult=e,i.resolve(e)})}}(this)):this.doResolve(e).then(function(e){return function(t){return e.previousResolveResult=t,i.resolve(t)}}(this)),this.currentChild=t,this.isActive=!0),r.then(function(t){return function(r){return"function"==typeof t.onActivate?t.onActivate(e,r):void 0}}(this)),this.currentParameters=e,i},r.prototype.deactivate=function(){var e;return this.isActive=!1,"function"==typeof this.onDeactivate&&this.onDeactivate(),null!=(e=this.currentChild)&&e.deactivate(),this.currentChild=null},r.prototype.generateRoute=function(e){var r;return((null!=(r=this.parent)?r.generateRoute(e).length:void 0)?this.parent.generateRoute(e)+"/":"")+(this.route?t.template(this.route)(e):"")},r.prototype.generateRouteString=function(){var e;return((null!=(e=this.parent)?e.generateRouteString().length:void 0)?this.parent.generateRouteString()+(this.route?"/":""):"")+(this.route?this.route:"")},r.prototype.generateName=function(){var e;return((null!=(e=this.parent)?e.statename:void 0)?this.parent.generateName()+".":"")+this.statename},r.prototype.getParentChain=function(){var e,t;return e=(null!=(t=this.parent)?t.getParentChain():void 0)||[],e.push(this),e},r}()}),function(e,t){var r,n,i;if("function"==typeof define&&define.amd)define("StateManager",["underscore","backbone"],function(r,n){return e.StateManager=new(t(r,n))});else{if("undefined"==typeof n)return e.StateManager=new(t(i,r));if(i=require("underscore"),r=require("Backbone"),n.StateManager=new(t(i,r)),"undefined"!=typeof module&&module.exports)return n=module.exports=new StateManager}}(this,function(e,t){var r;return r=function(){function r(){this.clear()}var n,i;return i={},n=null,r.prototype.router=new t.Router,r.prototype.go=function(e,t,r){var o;if(null==r&&(r={navigate:!0}),!i[e])throw new Error('No State with name "'+e+"' found.");return o=i[e],o.activate(t),n=o,r.navigate&&!o.abstract&&o.route?this.router.navigate(o.generateRoute(t)):void 0},r.prototype.registerState=function(t){var r;if(r=t.generateName(),i[t.generateName()])throw new Error('State with name "'+r+'" already exists.');return i[t.generateName()]=t,t.route&&!t.abstract?this.router.route(t.generateRouteString(),t.generateName(),function(r){var n;return n=arguments,r=e.object(e.map(t.generateRouteString().match(/:([a-zA-Z0-9\-_]+)/g),function(e,t){return[e.substring(1),n[t]]})),t.activate(r)}):void 0},r.prototype.getState=function(e){return i[e]},r.prototype.clear=function(){return null!=n&&n.getParentChain()[0].deactivate(),i={}},r}()});